<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mi Proyecto Firebase</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container shadow">
    <h1>Registro y Inicio de Sesión</h1>

    <!-- Formulario de Registro -->
    <form id="registerForm">
      <input type="email" id="email" placeholder="Correo Electrónico" required>
      <input type="password" id="password" placeholder="Contraseña" required>
      <button type="submit">Registrar</button>
    </form>

    <!-- Formulario de Inicio de Sesión -->
    <form id="loginForm">
      <input type="email" id="loginEmail" placeholder="Correo Electrónico" required>
      <input type="password" id="loginPassword" placeholder="Contraseña" required>
      <button type="submit">Iniciar Sesión</button>
    </form>
  </div>

  <!-- Agrega los scripts de Firebase -->
  <script type="module">
    // Importa las funciones que necesitas de las SDK que necesitas
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-database.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-analytics.js";

    // La configuración de Firebase de tu aplicación web
    const firebaseConfig = {
      apiKey: "AIzaSyA_x5k1sH6R-UhBjNBCezuon5vC10c1uks",
      authDomain: "base-de-datos-web-ffd19.firebaseapp.com",
      databaseURL: "https://base-de-datos-web-ffd19-default-rtdb.firebaseio.com",
      projectId: "base-de-datos-web-ffd19",
      storageBucket: "base-de-datos-web-ffd19.firebasestorage.app",
      messagingSenderId: "158026017847",
      appId: "1:158026017847:web:f796f0ed6cd0789d0863b2",
      measurementId: "G-0BEHQR0E1G"
    };

    // Inicializa Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth();
    const database = getDatabase();

    // Función para Registrar Usuarios
    document.getElementById('registerForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          const user = userCredential.user;
          // Guarda el usuario en la base de datos
          set(ref(database, 'users/' + user.uid), {
            email: user.email,
            uid: user.uid
          });
          console.log("Usuario registrado y guardado en la base de datos.");
        })
        .catch((error) => {
          console.error("Error al registrar el usuario:", error);
        });
    });

    // Función para Iniciar Sesión y Verificar Usuarios
    document.getElementById('loginForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;

      signInWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          const user = userCredential.user;
          // Recupera los datos del usuario desde la base de datos
          const dbRef = ref(getDatabase());
          get(child(dbRef, `users/${user.uid}`))
            .then((snapshot) => {
              if (snapshot.exists()) {
                console.log("Usuario verificado:", snapshot.val());
              } else {
                console.log("No se encontraron datos del usuario.");
              }
            })
            .catch((error) => {
              console.error("Error al verificar el usuario:", error);
            });
        })
        .catch((error) => {
          console.error("Error al iniciar sesión:", error);
        });
    });
  </script>
</body>
</html>
